<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Nexus AI â€” Checkout</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="style.css" rel="stylesheet"/>
</head>
<body>
  <div class="bg-wrap" aria-hidden="true">
    <div class="bg-anim"></div>
    <div class="background-glow"></div>
    <div class="grid-overlay"></div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
  </div>

    <header class="topbar">
    <div class="topbar-inner">
      <a class="brand" href="index.html" aria-label="Nexus AI Home">
        <div class="logo">
          <img src="assets/logos/Logo.jpg" alt="Nexus AI" class="logo-image">
        </div>
        <div class="brand-text">
          <div class="brand-name">Nexus AI</div>
          <div class="brand-sub">Community</div>
        </div>
      </a>

      <nav class="topnav" aria-label="Primary">
        <a class="toplink" href="index.html">Home</a>
        <a class="toplink" href="products.html">Products</a>
        <a class="toplink" href="contact.html">Contact</a>
      </nav>

      <div class="top-actions">
        <a class="cart-btn" href="cart.html" aria-label="View cart">
          <span class="cart-icon" aria-hidden="true">ðŸ›’</span>
          <span class="cart-label">Cart</span>
          <span class="cart-badge" data-cart-badge style="display:none;">0</span>
        </a>

        <button class="nav-toggle" aria-label="Open menu" aria-expanded="false" type="button">
          <span></span><span></span><span></span>
        </button>
      </div>
    </div>

    <div class="topnav-mobile" hidden>
      <a class="toplink" href="index.html">Home</a>
      <a class="toplink" href="products.html">Products</a>
        <a class="toplink" href="contact.html">Contact</a>
    </div>
  </header>
<main class="page" id="cart">
<section class="section reveal reveal-visible">
<div class="container">
<h2 class="section-title">Checkout</h2>
<p class="section-subtitle">Enter your email, choose payment method, submit order, then pay using instructions shown.</p>
<div class="checkout-stack">
<div class="card">
<div class="card-header">
<span class="pill">Order</span>
<h3>Summary</h3>
</div>
<div id="summary"></div>
<div class="cart-total" style="margin-top:12px;">
<span>Total</span>
<span id="total">$0.00</span>
</div>
<div class="btn-group" style="margin-top:14px;">
<a class="btn btn-ghost btn-compact" href="cart.html">Back</a>
<a class="btn btn-card btn-compact" href="products.html">Add More</a>
</div>
</div>
<div class="card">
<div class="card-header">
<span class="pill">Details</span>
<h3>Place Order</h3>
</div>
<form action="/success" data-netlify="true" id="orderForm" method="POST" name="order" netlify-honeypot="bot-field">
<input name="form-name" type="hidden" value="order"/>
<p style="display:none;">
<label>Donâ€™t fill this out: <input name="bot-field"/></label>
</p>
<label class="form-label">Email</label>
<input class="form-input" name="customer_email" placeholder="you@example.com" required="" type="email"/>
<label class="form-label">Payment Method</label>
<select class="form-input" id="payMethod" name="payment_method" required="">
<option value="">Select...</option>
<option value="Card">Card</option>
<option value="CashApp">CashApp</option>
</select>
<input id="orderItems" name="order_items" type="hidden"/>
<input id="orderTotal" name="order_total" type="hidden"/>
<div class="pay-instructions" id="payBox" style="display:none; margin-top:14px;"></div>
<button class="btn btn-primary" style="margin-top:14px; width:100%;" type="submit">
                Submit Order
              </button>
</form>
<div class="payments-note" style="margin-top:10px;">
              After you submit, complete payment using the instructions shown. We match payments using your email.
            </div>
</div>
</div>
</div>
</section>
</main>

  <script src="app.js"></script>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("orderForm");
    const sel = document.getElementById("payMethod");
    const box = document.getElementById("payBox");
    const STRIPE_LINK = "https://buy.stripe.com/dRm14n1xZb3m36m1Qu8k802";

    if (!form || !sel) return;

    function moneyFmt(n) {
      try {
        return window.money ? window.money(n) : "$" + Number(n || 0).toFixed(2);
      } catch {
        return "$" + Number(n || 0).toFixed(2);
      }
    }

    function renderCashAppNote() {
      if (!box) return;
      const method = sel.value || "";
      if (method !== "CashApp") {
        box.style.display = "none";
        box.innerHTML = "";
        return;
      }
      const total = window.cartTotal ? window.cartTotal() : 0;
      box.style.display = "block";
      box.innerHTML = `
        <div class="pill pill-outline">CashApp Note</div>
        <div class="pay-note" style="margin-top:10px;">
          You will be redirected to Stripe to complete payment.
          If you prefer CashApp, open a <b>Purchase Ticket</b> in Discord after submitting and weâ€™ll match your email.
          Total: <b>${moneyFmt(total)}</b>.
        </div>
        <div class="btn-group" style="margin-top:10px;">
          <a class="btn btn-card btn-compact" href="https://discord.gg/E5k4tfnYwZ" target="_blank" rel="noopener">Open Discord</a>
        </div>
      `;
    }

    sel.addEventListener("change", renderCashAppNote);
    renderCashAppNote();

    form.addEventListener("submit", async (e) => {
      // Always go to Stripe. Stripe will handle the success page.
      e.preventDefault();

      // Best-effort: still record the order in Netlify Forms before redirecting.
      try {
        const formData = new FormData(form);
        const params = new URLSearchParams();
        for (const [k, v] of formData.entries()) params.append(k, v);

        // Post to the current path (works for Netlify forms) without navigating.
        await fetch(window.location.pathname, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: params.toString()
        });
      } catch (err) {
        // Ignore â€” redirect to Stripe anyway.
      }

      window.location.href = STRIPE_LINK;
    });
  });
  </script>

</body>
</html>
